Region: us-west-2
Image:
  Os: centos7
HeadNode:
  InstanceType: r5n.4xlarge
  Networking:
    SubnetId: subnet-082a27707ecf43df2
  DisableSimultaneousMultithreading: false
  Ssh:
    KeyName: daylily
  Dcv:
    Enabled: true
    Port: 8443
  LocalStorage:
    RootVolume:
      Size: 500
      VolumeType: gp3
      DeleteOnTermination: false
    EphemeralVolume:
      MountDir: /head_root
  OnNodeConfigured:
    Script: s3://daylily-analysis-results/daylily_cluster_node_bootstrap.sh
Scheduling:
  Scheduler: slurm
  SlurmSettings:
    ScaledownIdletime: 13
    Dns:
      DisableManagedDns: false
    QueueUpdateStrategy: DRAIN
  SlurmQueues:
    - Name: i96-5
      CapacityType: SPOT
      AllocationStrategy: capacity-optimized
      ComputeResources:
        - Name: v24xl
          Instances:
            - InstanceType: r5n.metal  # 96/78
            - InstanceType: r5n.24xlarge  # 96/768  7,2
            - InstanceType: r5dn.metal  # 96/768  7,2
            - InstanceType: r5dn.24xlarge  # 96/768  7,2
            - InstanceType: r5b.metal  # 96/768  7,2
            - InstanceType: r5b.24xlarge  # 96/768  7,2
          MinCount: 0
          MaxCount: 1
          Networking:
            PlacementGroup:
              Enabled: false
          Efa:
            Enabled: false
      Networking:
        SubnetIds:
          - subnet-0b1e56841bc515c10
    - Name: i64-5
      CapacityType: SPOT
      AllocationStrategy: capacity-optimized
      ComputeResources:
        - Name: v16xl
          Instances:
            - InstanceType: r5b.16xlarge  # 64/512  4,1
            - InstanceType: r5dn.16xlarge  # 64/512  4,1
            - InstanceType: r5n.16xlarge  # 64/512   5,3
          MinCount: 0
          MaxCount: 1
          Networking:
            PlacementGroup:
              Enabled: false
          Efa:
            Enabled: false
      Networking:
        SubnetIds:
          - subnet-0b1e56841bc515c10
    - Name: i32-5
      CapacityType: SPOT
      AllocationStrategy: capacity-optimized
      ComputeResources:
        - Name: v8xl
          Instances:
            - InstanceType: r5b.8xlarge  # 32/256  2,1
            - InstanceType: r5dn.8xlarge  # 32/256  3,1
            - InstanceType: r5n.8xlarge  # 32/256   2,1
          MinCount: 0
          MaxCount: 2
          Networking:
            PlacementGroup:
              Enabled: false
          Efa:
            Enabled: false
      Networking:
        SubnetIds:
          - subnet-0b1e56841bc515c10
    - Name: i16-5
      CapacityType: SPOT
      AllocationStrategy: capacity-optimized
      ComputeResources:
        - Name: v4xl
          Instances:
            - InstanceType: r5b.4xlarge  # 16/128
            - InstanceType: r5dn.4xlarge  # 16/128
            - InstanceType: r5n.4xlarge  # 16/128
          MinCount: 0
          MaxCount: 2
          Networking:
            PlacementGroup:
              Enabled: false
          Efa:
            Enabled: false
      Networking:
        SubnetIds:
          - subnet-0b1e56841bc515c10
    - Name: i4-5
      CapacityType: SPOT
      AllocationStrategy: capacity-optimized
      ComputeResources:
        - Name: v2xl
          Instances:
            - InstanceType: r5.2xlarge  # 8/64
            - InstanceType: r5b.2xlarge  # 8/64
            - InstanceType: r5dn.2xlarge  # 8/64
            - InstanceType: r5n.2xlarge  #  8/64
            - InstanceType: r5d.2xlarge  #  8/64
          MinCount: 0
          MaxCount: 2
          Networking:
            PlacementGroup:
              Enabled: false
          Efa:
            Enabled: false
      Networking:
        SubnetIds:
          - subnet-0b1e56841bc515c10
    - Name: i128-6
      CapacityType: SPOT
      AllocationStrategy: capacity-optimized
      ComputeResources:
        - Name: v32xl
          Instances:
            - InstanceType: r6i.32xlarge  # 128/1024  8.0,6.2
            - InstanceType: r6i.metal  # 128/1024  8.0,2.4
            - InstanceType: r6in.32xlarge  # 128/1024 11.1,5.7
            - InstanceType: r6idn.32xlarge  # 128/1024  12.5,5.2
            - InstanceType: r6id.32xlarge  # 128/1024 9.6,3.11
            - InstanceType: r6id.metal  # 128/1024 9.6,3.11
          MinCount: 0
          MaxCount: 1
          Networking:
            PlacementGroup:
              Enabled: false
          Efa:
            Enabled: true
      Networking:
        SubnetIds:
          - subnet-0b1e56841bc515c10
Monitoring:
  Logs:
    CloudWatch:
      Enabled: true
      RetentionInDays: 14
SharedStorage:
  - MountDir: /fsx
    Name: fsx-for-day-data  # WARNING, EDIT NAME WILL DEL EXISTING DATA
    StorageType: FsxLustre
    FsxLustreSettings:
      ImportPath: s3://daylily-analysis-results
      ExportPath: s3://daylily-analysis-results
      StorageCapacity: 1200
      DeploymentType: SCRATCH_1
      AutoImportPolicy: NEW_CHANGED_DELETED
