#!/usr/bin/env bash
# This script is intended to be sourced, not executed directly.

# Check if DAY_ROOT is set; if not, source dyinit
if [[ -z "$DAY_ROOT" ]]; then
    source dyinit
fi

envi="$1"

echo "Requesting environment: $envi"

# Attempt to deactivate any existing environment
source bin/day_deactivate &> /dev/null || {
    echo "Attempted to deactivate existing environments but an error occurred."
    echo "Proceeding, but please check your PATH after completion."
}


# Handle build argument
if [[ "$1" == "BUILD" && "$ret_code" != "0" ]]; then

    # Source the environment installer
    source config/day/day_env_installer.sh DAY
    if [[ "$?" != "0" ]]; then
        echo "Error: Failed to install the DAY environment."
        return 1
    else
        echo "DAY environment installed successfully."
        return 0
    fi

else
    if [[ "$1" =~ ^(-h|--help|help)$ ]]; then
        echo "Usage: day-build [BUILD]"
        echo "This script builds the DAY conda environment (only needed once per working environment)."
        echo "Run 'day-build BUILD' to install conda and the DAY environment."
        return 0
    fi
fi


return 0
